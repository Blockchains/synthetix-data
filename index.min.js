!function(e,t){"object"==typeof module&&module.exports?module.exports=t(require("node-fetch")):e.snxData=t(e.fetch)}("undefined"!=typeof self?self:this,(function(e){"use strict";const t={snx:"https://api.thegraph.com/subgraphs/name/synthetixio-team/synthetix",depot:"https://api.thegraph.com/subgraphs/name/synthetixio-team/synthetix-depot",exchanges:"https://api.thegraph.com/subgraphs/name/synthetixio-team/synthetix-exchanges",rates:"https://api.thegraph.com/subgraphs/name/synthetixio-team/synthetix-rates"},r=({api:t,query:{entity:r,selection:o={},properties:s=[]},max:n=1/0})=>{n=Number(n);const i=({skip:a})=>{const m=e=>Object.entries(e).filter(([,e])=>void 0!==e).map(([e,t])=>`${e}:${"object"==typeof t?"{"+m(t)+"}":t}`).join(","),c=a+1e3>n?n%1e3:1e3,p=Object.assign({},o,{first:c,skip:a}),d=`{"query":"{${r}(${m(p)}){${s.join(",")}}}", "variables": null}`;return e(t,{method:"POST",body:d}).then(e=>e.json()).then(e=>{if(e.errors)throw Error(JSON.stringify(e.errors));const{data:{[r]:t}}=e;return t.length<1e3||Math.min(n,a+t.length)>=n?t:i({skip:a+1e3}).then(e=>t.concat(e))})};return i({skip:0})},o=e=>{const t=e.toString();let r="";for(let e=2;e<t.length;e+=2){const o=t.substr(e,2);"00"!==o&&(r+=String.fromCharCode(parseInt(o,16)))}return r};return{pageResults:r,graphAPIEndpoints:t,depot:{userActions:({network:e="mainnet",user:o,max:s=100})=>r({api:t.depot,query:{entity:"userActions",selection:{orderBy:"timestamp",orderDirection:"desc",where:{network:`\\"${e}\\"`,user:o?`\\"${o}\\"`:void 0}},properties:["id","user","amount","minimum","depositIndex","type","block","timestamp"]},max:s}).then(e=>e.map(({id:e,user:t,amount:r,type:o,minimum:s,depositIndex:n,block:i,timestamp:a})=>({hash:e.split("-")[0],user:t,amount:r/1e18,type:o,minimum:null!==s?Number(s):null,depositIndex:null!==n?Number(n):null,block:Number(i),timestamp:Number(1e3*a),date:new Date(1e3*a)}))).catch(e=>console.error(e)),clearedDeposits:({network:e="mainnet",fromAddress:o,toAddress:s,max:n=100})=>r({api:t.depot,query:{entity:"clearedDeposits",selection:{orderBy:"timestamp",orderDirection:"desc",where:{network:`\\"${e}\\"`,fromAddress:o?`\\"${o}\\"`:void 0,toAddress:s?`\\"${s}\\"`:void 0}},properties:["id","fromAddress","toAddress","fromETHAmount","toAmount","depositIndex","block","timestamp"]},max:n}).then(e=>e.map(({id:e,fromAddress:t,toAddress:r,fromETHAmount:o,toAmount:s,depositIndex:n,block:i,timestamp:a})=>({hash:e.split("-")[0],fromAddress:t,toAddress:r,fromETHAmount:o/1e18,toAmount:s/1e18,depositIndex:null!==n?Number(n):null,block:Number(i),timestamp:Number(1e3*a),date:new Date(1e3*a)}))).catch(e=>console.error(e))},exchanges:{total:({network:e="mainnet"}={})=>r({api:t.exchanges,query:{entity:"totals",selection:{where:{id:`\\"${e}\\"`}},properties:["exchangers","exchangeUSDTally","totalFeesGeneratedInUSD"]},max:1}).then(([{exchangers:e,exchangeUSDTally:t,totalFeesGeneratedInUSD:r}])=>({exchangers:Number(e),exchangeUSDTally:t/1e18,totalFeesGeneratedInUSD:r/1e18})).catch(e=>console.error(e)),since:({network:e="mainnet",timestampInSecs:s=Math.floor(Date.now()/1e3)-86400}={})=>r({api:t.exchanges,query:{entity:"synthExchanges",selection:{orderBy:"timestamp",orderDirection:"desc",where:{network:`\\"${e}\\"`,timestamp_gt:s}},properties:["id","from","gasPrice","from","fromAmount","fromAmountInUSD","fromCurrencyKey","toCurrencyKey","toAddress","toAmount","toAmountInUSD","feesInUSD","block","timestamp"]}}).then(e=>e.map(({gasPrice:e,timestamp:t,id:r,from:s,fromAmount:n,block:i,fromAmountInUSD:a,fromCurrencyKey:m,toAddress:c,toAmount:p,toAmountInUSD:d,toCurrencyKey:u,feesInUSD:h})=>({gasPrice:e/1e9,block:Number(i),timestamp:Number(1e3*t),date:new Date(1e3*t),hash:r.split("-")[0],fromAddress:s,fromAmount:n/1e18,fromCurrencyKeyBytes:m,fromCurrencyKey:o(m),fromAmountInUSD:a/1e18,toAmount:p/1e18,toAmountInUSD:d/1e18,toCurrencyKeyBytes:u,toCurrencyKey:o(u),toAddress:c,feesInUSD:h/1e18}))).catch(e=>console.error(e))},synths:{issuers:({max:e=10}={})=>r({api:t.snx,max:e,query:{entity:"issuers",properties:["id"]}}).then(e=>e.map(({id:e})=>e)).catch(e=>console.error(e)),transfers:({synth:e,from:o,to:s,max:n=100}={})=>r({api:t.snx,max:n,query:{entity:"transfers",selection:{orderBy:"timestamp",orderDirection:"desc",where:{source:e?`\\"${e}\\"`:void 0,source_not:'\\"SNX\\"',from:o?`\\"${o}\\"`:void 0,to:s?`\\"${s}\\"`:void 0}},properties:["id","source","to","from","value","block","timestamp"]}}).then(e=>e.map(({id:e,source:t,block:r,timestamp:o,from:s,to:n,value:i})=>({source:t,block:Number(r),timestamp:Number(1e3*o),date:new Date(1e3*o),hash:e.split("-")[0],from:s,to:n,value:i/1e18}))).catch(e=>console.error(e))},rates:{updateForSynth:({synth:e,max:o=100}={})=>r({api:t.rates,max:o,query:{entity:"rateUpdates",selection:{orderBy:"timestamp",orderDirection:"desc",where:{synth:`\\"${e}\\"`}},properties:["id","rate","block","timestamp"]}}).then(e=>e.map(({id:e,rate:t,block:r,timestamp:o})=>({block:Number(r),timestamp:Number(1e3*o),date:new Date(1e3*o),hash:e.split("-")[0],rate:t/1e18}))).catch(e=>console.error(e))},snx:{holders:({max:e=100}={})=>r({api:t.snx,max:e,query:{entity:"snxholders",properties:["id"]}}).then(e=>e.map(({id:e})=>e)).catch(e=>console.error(e)),total:()=>r({api:t.snx,query:{entity:"synthetixes",selection:{where:{id:1}},properties:["issuers","snxHolders"]},max:1}).then(([{issuers:e,snxHolders:t}])=>({issuers:Number(e),snxHolders:Number(t)})).catch(e=>console.error(e)),transfers:({from:e,to:o,max:s=100}={})=>r({api:t.snx,max:s,query:{entity:"transfers",selection:{orderBy:"timestamp",orderDirection:"desc",where:{source:'\\"SNX\\"',from:e?`\\"${e}\\"`:void 0,to:o?`\\"${o}\\"`:void 0}},properties:["id","to","from","value","block","timestamp"]}}).then(e=>e.map(({id:e,block:t,timestamp:r,from:o,to:s,value:n})=>({block:Number(t),timestamp:Number(1e3*r),date:new Date(1e3*r),hash:e.split("-")[0],from:o,to:s,value:n/1e18}))).catch(e=>console.error(e))}}}));
