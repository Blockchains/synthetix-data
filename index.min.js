!function(e,t){"object"==typeof module&&module.exports?module.exports=t(require("node-fetch")):e.snxData=t(e.fetch)}("undefined"!=typeof self?self:this,(function(e){"use strict";const t={snx:"https://api.thegraph.com/subgraphs/name/synthetixio-team/synthetix",depot:"https://api.thegraph.com/subgraphs/name/synthetixio-team/synthetix-depot",exchanges:"https://api.thegraph.com/subgraphs/name/synthetixio-team/synthetix-exchanges",rates:"https://api.thegraph.com/subgraphs/name/synthetixio-team/synthetix-rates"},o="0x"+"0".repeat(40),r=({api:t,query:{entity:o,selection:r={},properties:s=[]},max:n=1/0})=>{n=Number(n);const i=({skip:m})=>{const a=e=>Object.entries(e).filter(([,e])=>void 0!==e).map(([e,t])=>`${e}:${"object"==typeof t?"{"+a(t)+"}":t}`).join(","),c=m+1e3>n?n%1e3:1e3,d=Object.assign({},r,{first:c,skip:m}),p=`{"query":"{${o}(${a(d)}){${s.join(",")}}}", "variables": null}`;return"true"===process.env.DEBUG&&console.log(p),e(t,{method:"POST",body:p}).then(e=>e.json()).then(e=>{if(e.errors)throw Error(JSON.stringify(e.errors));const{data:{[o]:t}}=e;return t.length<1e3||Math.min(n,m+t.length)>=n?t:i({skip:m+1e3}).then(e=>t.concat(e))})};return i({skip:0})},s=e=>{const t=e.toString();let o="";for(let e=2;e<t.length;e+=2){const r=t.substr(e,2);"00"!==r&&(o+=String.fromCharCode(parseInt(r,16)))}return o};return{pageResults:r,graphAPIEndpoints:t,depot:{userActions:({network:e="mainnet",user:o,max:s=100})=>r({api:t.depot,query:{entity:"userActions",selection:{orderBy:"timestamp",orderDirection:"desc",where:{network:`\\"${e}\\"`,user:o?`\\"${o}\\"`:void 0}},properties:["id","user","amount","minimum","depositIndex","type","block","timestamp"]},max:s}).then(e=>e.map(({id:e,user:t,amount:o,type:r,minimum:s,depositIndex:n,block:i,timestamp:m})=>({hash:e.split("-")[0],user:t,amount:o/1e18,type:r,minimum:null!==s?Number(s):null,depositIndex:null!==n?Number(n):null,block:Number(i),timestamp:Number(1e3*m),date:new Date(1e3*m)}))).catch(e=>console.error(e)),clearedDeposits:({network:e="mainnet",fromAddress:o,toAddress:s,max:n=100})=>r({api:t.depot,query:{entity:"clearedDeposits",selection:{orderBy:"timestamp",orderDirection:"desc",where:{network:`\\"${e}\\"`,fromAddress:o?`\\"${o}\\"`:void 0,toAddress:s?`\\"${s}\\"`:void 0}},properties:["id","fromAddress","toAddress","fromETHAmount","toAmount","depositIndex","block","timestamp"]},max:n}).then(e=>e.map(({id:e,fromAddress:t,toAddress:o,fromETHAmount:r,toAmount:s,depositIndex:n,block:i,timestamp:m})=>({hash:e.split("-")[0],fromAddress:t,toAddress:o,fromETHAmount:r/1e18,toAmount:s/1e18,depositIndex:null!==n?Number(n):null,block:Number(i),timestamp:Number(1e3*m),date:new Date(1e3*m)}))).catch(e=>console.error(e))},exchanges:{total:({network:e="mainnet"}={})=>r({api:t.exchanges,query:{entity:"totals",selection:{where:{id:`\\"${e}\\"`}},properties:["exchangers","exchangeUSDTally","totalFeesGeneratedInUSD"]},max:1}).then(([{exchangers:e,exchangeUSDTally:t,totalFeesGeneratedInUSD:o}])=>({exchangers:Number(e),exchangeUSDTally:t/1e18,totalFeesGeneratedInUSD:o/1e18})).catch(e=>console.error(e)),since:({network:e="mainnet",max:o=1/0,timestampInSecs:n,minBlock:i,maxBlock:m}={})=>r({api:t.exchanges,max:o,query:{entity:"synthExchanges",selection:{orderBy:"timestamp",orderDirection:"desc",where:{network:`\\"${e}\\"`,timestamp_gt:n||void 0,block_gte:i||void 0,block_lte:m||void 0}},properties:["id","from","gasPrice","from","fromAmount","fromAmountInUSD","fromCurrencyKey","toCurrencyKey","toAddress","toAmount","toAmountInUSD","feesInUSD","block","timestamp"]}}).then(e=>e.map(({gasPrice:e,timestamp:t,id:o,from:r,fromAmount:n,block:i,fromAmountInUSD:m,fromCurrencyKey:a,toAddress:c,toAmount:d,toAmountInUSD:p,toCurrencyKey:l,feesInUSD:u})=>({gasPrice:e/1e9,block:Number(i),timestamp:Number(1e3*t),date:new Date(1e3*t),hash:o.split("-")[0],fromAddress:r,fromAmount:n/1e18,fromCurrencyKeyBytes:a,fromCurrencyKey:s(a),fromAmountInUSD:m/1e18,toAmount:d/1e18,toAmountInUSD:p/1e18,toCurrencyKeyBytes:l,toCurrencyKey:s(l),toAddress:c,feesInUSD:u/1e18}))).catch(e=>console.error(e))},synths:{issuers:({max:e=10}={})=>r({api:t.snx,max:e,query:{entity:"issuers",properties:["id"]}}).then(e=>e.map(({id:e})=>e)).catch(e=>console.error(e)),transfers:({synth:e,from:s,to:n,max:i=100,minBlock:m,maxBlock:a}={})=>r({api:t.snx,max:i,query:{entity:"transfers",selection:{orderBy:"timestamp",orderDirection:"desc",where:{source:e?`\\"${e}\\"`:void 0,source_not:'\\"SNX\\"',from:s?`\\"${s}\\"`:void 0,to:n?`\\"${n}\\"`:void 0,from_not:`\\"${o}\\"`,to_not:`\\"${o}\\"`,block_gte:m||void 0,block_lte:a||void 0}},properties:["id","source","to","from","value","block","timestamp"]}}).then(e=>e.map(({id:e,source:t,block:o,timestamp:r,from:s,to:n,value:i})=>({source:t,block:Number(o),timestamp:Number(1e3*r),date:new Date(1e3*r),hash:e.split("-")[0],from:s,to:n,value:i/1e18}))).catch(e=>console.error(e))},rate:{updates:({synth:e,minBlock:o,maxBlock:s,max:n=100}={})=>r({api:t.rates,max:n,query:{entity:"rateUpdates",selection:{orderBy:"timestamp",orderDirection:"desc",where:{synth:e?`\\"${e}\\"`:void 0,synth_not_in:"["+["SNX","ETH","XDR"].map(e=>`\\"${e}\\"`).join(",")+"]",block_gte:o||void 0,block_lte:s||void 0}},properties:["id","synth","rate","block","timestamp"]}}).then(e=>e.map(({id:e,rate:t,block:o,timestamp:r,synth:s})=>({block:Number(o),synth:s,timestamp:Number(1e3*r),date:new Date(1e3*r),hash:e.split("-")[0],rate:t/1e18}))).catch(e=>console.error(e))},snx:{holders:({max:e=100}={})=>r({api:t.snx,max:e,query:{entity:"snxholders",properties:["id"]}}).then(e=>e.map(({id:e})=>e)).catch(e=>console.error(e)),total:()=>r({api:t.snx,query:{entity:"synthetixes",selection:{where:{id:1}},properties:["issuers","snxHolders"]},max:1}).then(([{issuers:e,snxHolders:t}])=>({issuers:Number(e),snxHolders:Number(t)})).catch(e=>console.error(e)),transfers:({from:e,to:o,max:s=100,minBlock:n,maxBlock:i}={})=>r({api:t.snx,max:s,query:{entity:"transfers",selection:{orderBy:"timestamp",orderDirection:"desc",where:{source:'\\"SNX\\"',from:e?`\\"${e}\\"`:void 0,to:o?`\\"${o}\\"`:void 0,block_gte:n||void 0,block_lte:i||void 0}},properties:["id","to","from","value","block","timestamp"]}}).then(e=>e.map(({id:e,block:t,timestamp:o,from:r,to:s,value:n})=>({block:Number(t),timestamp:Number(1e3*o),date:new Date(1e3*o),hash:e.split("-")[0],from:r,to:s,value:n/1e18}))).catch(e=>console.error(e))}}}));
