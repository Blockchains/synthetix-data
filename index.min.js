!function(e,t){"object"==typeof module&&module.exports?module.exports=t(require("node-fetch")):e.snxData=t(e.fetch)}("undefined"!=typeof self?self:this,(function(e){"use strict";const t={snx:"https://api.thegraph.com/subgraphs/name/synthetixio-team/synthetix",depot:"https://api.thegraph.com/subgraphs/name/synthetixio-team/synthetix-depot",exchanges:"https://api.thegraph.com/subgraphs/name/synthetixio-team/synthetix-exchanges",rates:"https://api.thegraph.com/subgraphs/name/synthetixio-team/synthetix-rates"},r="0x"+"0".repeat(40),o=({api:t,query:{entity:r,selection:o={},properties:s=[]},max:n=1/0})=>{n=Number(n);const a=({skip:i})=>{const m=e=>Object.entries(e).filter(([,e])=>void 0!==e).map(([e,t])=>`${e}:${"object"==typeof t?"{"+m(t)+"}":t}`).join(","),c=i+1e3>n?n%1e3:1e3,d=Object.assign({},o,{first:c,skip:i}),l=`{"query":"{${r}(${m(d)}){${s.join(",")}}}", "variables": null}`;return"true"===process.env.DEBUG&&console.log(l),e(t,{method:"POST",body:l}).then(e=>e.json()).then(e=>{if(e.errors)throw Error(JSON.stringify(e.errors));const{data:{[r]:t}}=e;return t.length<1e3||Math.min(n,i+t.length)>=n?t:a({skip:i+1e3}).then(e=>t.concat(e))})};return a({skip:0})},s=e=>{const t=e.toString();let r="";for(let e=2;e<t.length;e+=2){const o=t.substr(e,2);"00"!==o&&(r+=String.fromCharCode(parseInt(o,16)))}return r};return{pageResults:o,graphAPIEndpoints:t,depot:{userActions:({network:e="mainnet",user:r,max:s=100})=>o({api:t.depot,query:{entity:"userActions",selection:{orderBy:"timestamp",orderDirection:"desc",where:{network:`\\"${e}\\"`,user:r?`\\"${r}\\"`:void 0}},properties:["id","user","amount","minimum","depositIndex","type","block","timestamp"]},max:s}).then(e=>e.map(({id:e,user:t,amount:r,type:o,minimum:s,depositIndex:n,block:a,timestamp:i})=>({hash:e.split("-")[0],user:t,amount:r/1e18,type:o,minimum:null!==s?Number(s):null,depositIndex:null!==n?Number(n):null,block:Number(a),timestamp:Number(1e3*i),date:new Date(1e3*i)}))).catch(e=>console.error(e)),clearedDeposits:({network:e="mainnet",fromAddress:r,toAddress:s,max:n=100})=>o({api:t.depot,query:{entity:"clearedDeposits",selection:{orderBy:"timestamp",orderDirection:"desc",where:{network:`\\"${e}\\"`,fromAddress:r?`\\"${r}\\"`:void 0,toAddress:s?`\\"${s}\\"`:void 0}},properties:["id","fromAddress","toAddress","fromETHAmount","toAmount","depositIndex","block","timestamp"]},max:n}).then(e=>e.map(({id:e,fromAddress:t,toAddress:r,fromETHAmount:o,toAmount:s,depositIndex:n,block:a,timestamp:i})=>({hash:e.split("-")[0],fromAddress:t,toAddress:r,fromETHAmount:o/1e18,toAmount:s/1e18,depositIndex:null!==n?Number(n):null,block:Number(a),timestamp:Number(1e3*i),date:new Date(1e3*i)}))).catch(e=>console.error(e))},exchanges:{total:({network:e="mainnet"}={})=>o({api:t.exchanges,query:{entity:"totals",selection:{where:{id:`\\"${e}\\"`}},properties:["exchangers","exchangeUSDTally","totalFeesGeneratedInUSD"]},max:1}).then(([{exchangers:e,exchangeUSDTally:t,totalFeesGeneratedInUSD:r}])=>({exchangers:Number(e),exchangeUSDTally:t/1e18,totalFeesGeneratedInUSD:r/1e18})).catch(e=>console.error(e)),since:({network:e="mainnet",max:r=1/0,timestampInSecs:n,minBlock:a,maxBlock:i,fromAddress:m}={})=>o({api:t.exchanges,max:r,query:{entity:"synthExchanges",selection:{orderBy:"timestamp",orderDirection:"desc",where:{network:`\\"${e}\\"`,timestamp_gt:n||void 0,block_gte:a||void 0,block_lte:i||void 0,from:m?`\\"${m}\\"`:void 0}},properties:["id","from","gasPrice","from","fromAmount","fromAmountInUSD","fromCurrencyKey","toCurrencyKey","toAddress","toAmount","toAmountInUSD","feesInUSD","block","timestamp"]}}).then(e=>e.map(({gasPrice:e,timestamp:t,id:r,from:o,fromAmount:n,block:a,fromAmountInUSD:i,fromCurrencyKey:m,toAddress:c,toAmount:d,toAmountInUSD:l,toCurrencyKey:p,feesInUSD:u})=>({gasPrice:e/1e9,block:Number(a),timestamp:Number(1e3*t),date:new Date(1e3*t),hash:r.split("-")[0],fromAddress:o,fromAmount:n/1e18,fromCurrencyKeyBytes:m,fromCurrencyKey:s(m),fromAmountInUSD:i/1e18,toAmount:d/1e18,toAmountInUSD:l/1e18,toCurrencyKeyBytes:p,toCurrencyKey:s(p),toAddress:c,feesInUSD:u/1e18}))).catch(e=>console.error(e))},synths:{issuers:({max:e=10}={})=>o({api:t.snx,max:e,query:{entity:"issuers",properties:["id"]}}).then(e=>e.map(({id:e})=>e)).catch(e=>console.error(e)),transfers:({synth:e,from:s,to:n,max:a=100,minBlock:i,maxBlock:m}={})=>o({api:t.snx,max:a,query:{entity:"transfers",selection:{orderBy:"timestamp",orderDirection:"desc",where:{source:e?`\\"${e}\\"`:void 0,source_not:'\\"SNX\\"',from:s?`\\"${s}\\"`:void 0,to:n?`\\"${n}\\"`:void 0,from_not:`\\"${r}\\"`,to_not:`\\"${r}\\"`,block_gte:i||void 0,block_lte:m||void 0}},properties:["id","source","to","from","value","block","timestamp"]}}).then(e=>e.map(({id:e,source:t,block:r,timestamp:o,from:s,to:n,value:a})=>({source:t,block:Number(r),timestamp:Number(1e3*o),date:new Date(1e3*o),hash:e.split("-")[0],from:s,to:n,value:a/1e18}))).catch(e=>console.error(e))},rate:{updates:({synth:e,minBlock:r,maxBlock:s,max:n=100}={})=>o({api:t.rates,max:n,query:{entity:"rateUpdates",selection:{orderBy:"timestamp",orderDirection:"desc",where:{synth:e?`\\"${e}\\"`:void 0,synth_not_in:"["+["SNX","ETH","XDR"].map(e=>`\\"${e}\\"`).join(",")+"]",block_gte:r||void 0,block_lte:s||void 0}},properties:["id","synth","rate","block","timestamp"]}}).then(e=>e.map(({id:e,rate:t,block:r,timestamp:o,synth:s})=>({block:Number(r),synth:s,timestamp:Number(1e3*o),date:new Date(1e3*o),hash:e.split("-")[0],rate:t/1e18}))).catch(e=>console.error(e))},snx:{holders:({max:e=100}={})=>o({api:t.snx,max:e,query:{entity:"snxholders",selection:{orderBy:"collateral",orderDirection:"desc"},properties:["id","collateral"]}}).then(e=>e.map(({id:e,collateral:t})=>({address:e,collateral:t?t/1e18:null}))).catch(e=>console.error(e)),rewards:({max:e=100}={})=>o({api:t.snx,max:e,query:{entity:"rewardEscrowHolders",properties:["id","balanceOf"]}}).then(e=>e.map(({id:e,balanceOf:t})=>({address:e,balance:t/1e18}))).catch(e=>console.error(e)),total:()=>o({api:t.snx,query:{entity:"synthetixes",selection:{where:{id:1}},properties:["issuers","snxHolders"]},max:1}).then(([{issuers:e,snxHolders:t}])=>({issuers:Number(e),snxHolders:Number(t)})).catch(e=>console.error(e)),transfers:({from:e,to:r,max:s=100,minBlock:n,maxBlock:a}={})=>o({api:t.snx,max:s,query:{entity:"transfers",selection:{orderBy:"timestamp",orderDirection:"desc",where:{source:'\\"SNX\\"',from:e?`\\"${e}\\"`:void 0,to:r?`\\"${r}\\"`:void 0,block_gte:n||void 0,block_lte:a||void 0}},properties:["id","to","from","value","block","timestamp"]}}).then(e=>e.map(({id:e,block:t,timestamp:r,from:o,to:s,value:n})=>({block:Number(t),timestamp:Number(1e3*r),date:new Date(1e3*r),hash:e.split("-")[0],from:o,to:s,value:n/1e18}))).catch(e=>console.error(e))}}}));
