!function(e,t){"object"==typeof module&&module.exports?module.exports=t(require("node-fetch")):e.snxData=t(e.fetch)}("undefined"!=typeof self?self:this,(function(e){"use strict";const t={snx:"https://api.thegraph.com/subgraphs/name/synthetixio-team/synthetix",depot:"https://api.thegraph.com/subgraphs/name/synthetixio-team/synthetix-depot",exchanges:"https://api.thegraph.com/subgraphs/name/synthetixio-team/synthetix-exchanges",rates:"https://api.thegraph.com/subgraphs/name/synthetixio-team/synthetix-rates"},r=({api:t,query:{entity:r,selection:s={},properties:o=[]},max:n=1/0})=>{n=Number(n);const i=({skip:m})=>{const a=e=>Object.entries(e).filter(([,e])=>void 0!==e).map(([e,t])=>`${e}:${"object"==typeof t?"{"+a(t)+"}":t}`).join(","),d=m+1e3>n?n%1e3:1e3,c=Object.assign({},s,{first:d,skip:m}),p=`{"query":"{${r}(${a(c)}){${o.join(",")}}}", "variables": null}`;return e(t,{method:"POST",body:p}).then(e=>e.json()).then(e=>{if(e.errors)throw Error(JSON.stringify(e.errors));const{data:{[r]:t}}=e;return t.length<1e3||Math.min(n,m+t.length)>=n?t:i({skip:m+1e3}).then(e=>t.concat(e))})};return i({skip:0})},s=e=>{const t=e.toString();let r="";for(let e=2;e<t.length;e+=2){const s=t.substr(e,2);"00"!==s&&(r+=String.fromCharCode(parseInt(s,16)))}return r};return{pageResults:r,graphAPIEndpoints:t,depot:{userActions:({network:e="mainnet",user:s,max:o=100})=>r({api:t.depot,query:{entity:"userActions",selection:{orderBy:"timestamp",orderDirection:"desc",where:{network:`\\"${e}\\"`,user:s?`\\"${s}\\"`:void 0}},properties:["id","user","amount","minimum","depositIndex","type","block","timestamp"]},max:o}).then(e=>e.map(({id:e,user:t,amount:r,type:s,minimum:o,depositIndex:n,block:i,timestamp:m})=>({hash:e.split("-")[0],user:t,amount:r/1e18,type:s,minimum:null!==o?Number(o):null,depositIndex:null!==n?Number(n):null,block:Number(i),timestamp:Number(1e3*m),date:new Date(1e3*m)}))).catch(e=>console.error(e)),clearedDeposits:({network:e="mainnet",fromAddress:s,toAddress:o,max:n=100})=>r({api:t.depot,query:{entity:"clearedDeposits",selection:{orderBy:"timestamp",orderDirection:"desc",where:{network:`\\"${e}\\"`,fromAddress:s?`\\"${s}\\"`:void 0,toAddress:o?`\\"${o}\\"`:void 0}},properties:["id","fromAddress","toAddress","fromETHAmount","toAmount","depositIndex","block","timestamp"]},max:n}).then(e=>e.map(({id:e,fromAddress:t,toAddress:r,fromETHAmount:s,toAmount:o,depositIndex:n,block:i,timestamp:m})=>({hash:e.split("-")[0],fromAddress:t,toAddress:r,fromETHAmount:s/1e18,toAmount:o/1e18,depositIndex:null!==n?Number(n):null,block:Number(i),timestamp:Number(1e3*m),date:new Date(1e3*m)}))).catch(e=>console.error(e))},exchanges:{total:({network:e="mainnet"}={})=>r({api:t.exchanges,query:{entity:"totals",selection:{where:{id:`\\"${e}\\"`}},properties:["exchangers","exchangeUSDTally","totalFeesGeneratedInUSD"]},max:1}).then(([{exchangers:e,exchangeUSDTally:t,totalFeesGeneratedInUSD:r}])=>({exchangers:Number(e),exchangeUSDTally:t/1e18,totalFeesGeneratedInUSD:r/1e18})).catch(e=>console.error(e)),since:({network:e="mainnet",timestampInSecs:o=Math.floor(Date.now()/1e3)-86400}={})=>r({api:t.exchanges,query:{entity:"synthExchanges",selection:{orderBy:"timestamp",orderDirection:"desc",where:{network:`\\"${e}\\"`,timestamp_gt:o}},properties:["id","from","gasPrice","from","fromAmount","fromAmountInUSD","fromCurrencyKey","toCurrencyKey","toAddress","toAmount","toAmountInUSD","feesInUSD","block","timestamp"]}}).then(e=>e.map(({gasPrice:e,timestamp:t,id:r,from:o,fromAmount:n,block:i,fromAmountInUSD:m,fromCurrencyKey:a,toAddress:d,toAmount:c,toAmountInUSD:p,toCurrencyKey:u,feesInUSD:h})=>({gasPrice:e/1e9,block:Number(i),timestamp:Number(1e3*t),date:new Date(1e3*t),hash:r.split("-")[0],fromAddress:o,fromAmount:n/1e18,fromCurrencyKeyBytes:a,fromCurrencyKey:s(a),fromAmountInUSD:m/1e18,toAmount:c/1e18,toAmountInUSD:p/1e18,toCurrencyKeyBytes:u,toCurrencyKey:s(u),toAddress:d,feesInUSD:h/1e18}))).catch(e=>console.error(e))},synths:{issuers:({max:e=10}={})=>r({api:t.snx,max:e,query:{entity:"issuers",properties:["id"]}}).then(e=>e.map(({id:e})=>e)).catch(e=>console.error(e))},snx:{holders:({max:e=100}={})=>r({api:t.snx,max:e,query:{entity:"snxholders",properties:["id"]}}).then(e=>e.map(({id:e})=>e)).catch(e=>console.error(e)),total:()=>r({api:t.snx,query:{entity:"synthetixes",selection:{where:{id:1}},properties:["issuers","snxHolders"]},max:1}).then(([{issuers:e,snxHolders:t}])=>({issuers:Number(e),snxHolders:Number(t)})).catch(e=>console.error(e))}}}));
